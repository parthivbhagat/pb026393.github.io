<!DOCTYPE html>
<html>
  <!--
  Original Design: David McCandless & Stefanie Posavec for Wired Magazine <http://informationisbeautiful.net>
  Implementation: Arjun Sanyal <arjun.sanyal@childrens.harvard.edu>
  -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>SMART ON FHIR STARTER APP</title>
    <style>
      #errors {
        font-size: 16px;
        font-family: Calibri, "Helvetica Neue", Helvetica, Verdana, sans-serif;
        color: #555;
      }
    </style>

    <script src="./lib/fhir-client.js"></script>

    <script src='./lib/jquery.min.js'></script>
    
	<script>
      extractData().then(function(p){
        var missing_data_array = report_missing_data(p);
        if (missing_data_array.length > 0) {
          $('#errors')
          .show()
          .html(function(){
            var out = '<h2>Can\'t Compute Cardiovascular Risk Score</h2><p>Can\'t compute cardiovascular risk score from available data because of the following issues:</p><ul>';
              $.each(missing_data_array, function(i, v){ out += '<li>' + missing_data_array[i] + '</li>'; }) 
              return out + '</ul>';
          });

          return; // abort script
          } else {
          $('#holder').show();
          alert(p);
        }			 

      });

      // checks for data needed to compute risk score. returns a possibly empty array of strings.
      // if the array is empty everything's ok. TODO: seperate missing and out of range criteria
      var report_missing_data = function(p){
        var a = [];
        if (p.gender.value != 'male' && p.gender.value != 'female') a.push('Gender is required')
        return a;
      };
    </script>
  </head>
  <body style="margin: none;">
    <h1> Hello World </h1>
    <div id='errors' style='display: none; width: 600px; margin: 100px auto;'></div>
    <div id='holder' style='display: none; height: 1200px; width: 780px;'>
    </div>
    <div id='log'></div>
  </body>
</html>
